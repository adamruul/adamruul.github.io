
<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta content="" name="keywords">
<meta content="Solving the Spotify Labs Puzzles with Erlang - Adam Ruul" property="og:title">
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
<title>Solving the Spotify Labs Puzzles with Erlang | Adam Ruul</title>
<link rel="stylesheet" href="https://adamruul.github.io//css/style.css">
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css" integrity="sha256-Zd1icfZ72UBmsId/mUcagrmN7IN5Qkrvh75ICHIQVTk=" crossorigin="anonymous" />


<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="https://adamruul.github.io/"><div class="bor1"><div class="bor2"><h1 class="title is-4">Adam Ruul</h1></div></div></a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile">
          
          <a class="level-item" href="https://github.com/adamruul">
            <span class="icon">
              <i class="fa fa-github"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://twitter.com/AdamRuul">
            <span class="icon">
              <i class="fa fa-twitter"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://linkedin.com/in/adam-ruul-5933198b">
            <span class="icon">
              <i class="fa fa-linkedin"></i>
            </span>
          </a>
          
          <a class="level-item" href="/index.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>
          </a>
          
        </nav>
      </div>
    </nav>
  </div>
</section>

<section class="section">
  <div class="container">
    <h2 class="subtitle is-6">November 8, 2016</h2>
    <h1 class="title">Solving the Spotify Labs Puzzles with Erlang</h1>
    
    <div class="content">
      

<hr />

<blockquote>
<ul>
<li><a href="#reversed-binary-numbers">Reversed Binary Numbers</a></li>
<li><a href="#zipf-s-song">Zipf&rsquo;s Song</a></li>
</ul>
</blockquote>

<h2 id="introduction">Introduction</h2>

<p>Lately, I&rsquo;ve been getting into the world of Erlang. To sharpen my skills, I tried solving two of the <a href="https://labs.spotify.com/puzzles/">puzzles posted by Spotify Labs</a>.</p>

<p>The source code for the solutions can be found in this <a href="https://github.com/adamruul/Spotify_Puzzles">repository</a>. The solutions does not support the stdin/stdout requierment that was stated, nor is Erlang a valid language to officially submit a solution in. I solved the puzzles mostly because they are great puzzles to solve when trying to learn a new language (Erlang in my case).</p>

<hr />

<h2 id="reversed-binary-numbers">Reversed Binary Numbers</h2>

<p>So this puzzle is a typical &ldquo;reverse-a-string&rdquo;-puzzle &ndash;  <em>with some twists</em>.</p>

<p>First of all we need to calculate the binary representation of the input number.
One common pitfall is to convert the input number into a fixed bit binary number (eg: 8bit binary number). For smaller inputs, you&rsquo;ll end up with padding zeros for the MSBs. Reversing this will result in the wrong reversed value.</p>

<p><strong>WRONG:</strong></p>

<pre><code>Decimal: 4
Binary(8bit): 00000100
Reversed Binary: 00100000
Decimal Result: 32
</code></pre>

<p><strong>CORRECT:</strong></p>

<pre><code>Decimal: 4
Binary: 100
Reversed Binary: 001
Decimal Result: 1
</code></pre>

<p>In Erlang we have the nifty functions <code>integer_to_list/2</code> and <code>list_to_integer/2</code>, taking two arguments: An integer respectively A List/String, and a Base. Using these functions with base 2 will convert a decimal number into its binary (non-zero-padded) representation, and convert it back to its decimal representation. Once we&rsquo;ve converted the decimal number into its binary representation, we can just use <code>lists:reverse/1</code> to reverse the binary number, before converting it back to its decimal representation.</p>

<hr />

<h3 id="code">Code</h3>

<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #000000">binary_reverse</span>(<span style="color: #000000">Integer</span>) <span style="color: #000000">-&gt;</span>
  <span style="color: #000000">binary_reverse</span>(<span style="color: #000000">Integer</span>,<span style="color: #1C01CE">2</span>).

<span style="color: #000000">binary_reverse</span>(<span style="color: #000000">Integer</span>,<span style="color: #000000">Base</span>) <span style="color: #000000">-&gt;</span>
	<span style="color: #A90D91">list_to_integer</span>(
		<span style="color: #000000">lists</span>:<span style="color: #000000">reverse</span>(
			<span style="color: #A90D91">integer_to_list</span>(<span style="color: #000000">Integer</span>,<span style="color: #000000">Base</span>)),<span style="color: #000000">Base</span>).
</pre></div>


<hr />

<h2 id="zipf-s-song">Zipf&rsquo;s Song</h2>

<p>In this puzzle, we first need to assign a score to each track of the album using the number of plays and the &ldquo;Zipf score&rdquo;.
Zipf&rsquo;s law says that the frequency of the <code>i</code>&lsquo;th most common object shold be proportional to <code>1/i</code>. In our context, the most common song on a album will be the first song (track 1) and the least common song will be the last song on the album (track <code>n</code>).</p>

<p>So to define the quality of the song using Zipf&rsquo;s Law, we&rsquo;ll need to multiply the number of plays for each track with how &ldquo;common&rdquo; the track is (the track position on the album).</p>

<p>This will result in:</p>

<pre><code>Score(Track 1) = NR_PLAYS(Track 1) * 1
Score(Track 2) = NR_PLAYS(Track 2) * 2
Score(Track 3) = NR_PLAYS(Track 3) * 3
.
.
.
Score(Track n) = NR_PLAYS(Track n) * n
</code></pre>

<p>So to solve the puzzle, we just need to multiply each track&rsquo;s play-count with its position. Then we just filter out the <code>m</code> highest scoring tracks.</p>

<h3 id="code-1">Code</h3>

<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #000000">zipf_prop</span>(<span style="color: #000000">List</span>) <span style="color: #000000">-&gt;</span>
	<span style="color: #000000">Indexed</span> <span style="color: #000000">=</span> [{<span style="color: #000000">lists</span>:<span style="color: #000000">nth</span>(<span style="color: #000000">C</span>,<span style="color: #000000">List</span>),<span style="color: #000000">C</span>} || <span style="color: #000000">C</span> <span style="color: #000000">&lt;-</span> <span style="color: #000000">lists</span>:<span style="color: #000000">seq</span>(<span style="color: #1C01CE">1</span>,<span style="color: #A90D91">length</span>(<span style="color: #000000">List</span>))],
    [{<span style="color: #000000">I</span>,<span style="color: #000000">Tr</span>} || {{_,<span style="color: #000000">Tr</span>},<span style="color: #000000">I</span>} <span style="color: #000000">&lt;-</span> <span style="color: #000000">Indexed</span>].

<span style="color: #000000">zipf_songs</span>(<span style="color: #000000">Album</span>,<span style="color: #000000">N</span>,<span style="color: #000000">M</span>) <span style="color: #000000">-&gt;</span>
	<span style="color: #000000">S</span> <span style="color: #000000">=</span> <span style="color: #000000">lists</span>:<span style="color: #000000">zip</span>(<span style="color: #000000">Album</span>,<span style="color: #000000">zipf_prop</span>(<span style="color: #000000">Album</span>)), <span style="color: #177500">% add index to each track</span>
	<span style="color: #000000">Score</span> <span style="color: #000000">=</span> [{<span style="color: #000000">Track</span>, <span style="color: #000000">Plays</span> <span style="color: #000000">*</span> <span style="color: #000000">Prop</span>} || {{<span style="color: #000000">Plays</span>,<span style="color: #000000">Track</span>},{<span style="color: #000000">Prop</span>,_}} <span style="color: #000000">&lt;-</span> <span style="color: #000000">S</span> ], <span style="color: #177500">% multiply nr of plays with how common the track is (index).</span>
	<span style="color: #000000">TupleSort</span> <span style="color: #000000">=</span> <span style="color: #A90D91">fun</span>({<span style="color: #000000">KeyA</span>,<span style="color: #000000">ValA</span>}, {<span style="color: #000000">KeyB</span>,<span style="color: #000000">ValB</span>}) <span style="color: #000000">-&gt;</span> {<span style="color: #000000">ValA</span>,<span style="color: #000000">KeyA</span>} <span style="color: #000000">=&lt;</span> {<span style="color: #000000">ValB</span>,<span style="color: #000000">KeyB</span>} <span style="color: #A90D91">end</span>, <span style="color: #177500">% just a help-function for sorting tuples.</span>
	<span style="color: #000000">MostPopular</span> <span style="color: #000000">=</span> <span style="color: #000000">lists</span>:<span style="color: #000000">nthtail</span>(<span style="color: #000000">N-M</span>, <span style="color: #000000">lists</span>:<span style="color: #000000">sort</span>(<span style="color: #000000">TupleSort</span>, <span style="color: #000000">Score</span>)), <span style="color: #177500">% Sort the list and grab the M most popular songs.</span>
	[<span style="color: #000000">Track</span> || {<span style="color: #000000">Track</span>,_} <span style="color: #000000">&lt;-</span> <span style="color: #000000">lists</span>:<span style="color: #000000">reverse</span>(<span style="color: #000000">MostPopular</span>)].  <span style="color: #177500">% Make the list descending and remove the score.</span>


<span style="color: #177500">% Example Usage:</span>
<span style="color: #000000">N</span> <span style="color: #000000">=</span> <span style="color: #1C01CE">4</span>, <span style="color: #177500">% number of tracks on album</span>
<span style="color: #000000">M</span> <span style="color: #000000">=</span> <span style="color: #1C01CE">2</span>, <span style="color: #177500">% number of top-tracks to find.</span>
<span style="color: #000000">Album</span> <span style="color: #000000">=</span> [{<span style="color: #1C01CE">30</span>,<span style="color: #C41A16">&quot;one&quot;</span>},{<span style="color: #1C01CE">30</span>,<span style="color: #C41A16">&quot;two&quot;</span>},{<span style="color: #1C01CE">15</span>,<span style="color: #C41A16">&quot;three&quot;</span>},{<span style="color: #1C01CE">25</span>,<span style="color: #C41A16">&quot;four&quot;</span>}], <span style="color: #177500">% Input album formatted as: {Nr_Plays, Track_Name}</span>
<span style="color: #000000">Result</span> <span style="color: #000000">=</span> <span style="color: #000000">zipf_songs</span>(<span style="color: #000000">Album</span>,<span style="color: #000000">N</span>,<span style="color: #000000">M</span>),
<span style="color: #000000">lists</span>:<span style="color: #000000">map</span>(<span style="color: #A90D91">fun</span>(<span style="color: #000000">X</span>) <span style="color: #000000">-&gt;</span> <span style="color: #000000">io</span>:<span style="color: #000000">format</span>(<span style="color: #C41A16">&quot;~p~n&quot;</span>,[<span style="color: #000000">X</span>]) <span style="color: #A90D91">end</span>, <span style="color: #000000">Result</span>), <span style="color: #177500">% print result</span>
</pre></div>


    </div>
  </div>
</section>


<section class="section">
  <div class="container has-text-centered">
    <p></p>
  </div>
</section>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js" integrity="sha256-KbfTjB0WZ8vvXngdpJGY3Yp3xKk+tttbqClO11anCIU=" crossorigin="anonymous"></script>

<script>hljs.initHighlightingOnLoad();</script>


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-92975790-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>



